syntax = "proto3";

package map_service;

message GetMapRequest {
  // Empty
}

// Структура Pose для передачи происхождения карты
message Pose {
  float position_x = 1;
  float position_y = 2;
  float position_z = 3;
  float orientation_x = 4;
  float orientation_y = 5;
  float orientation_z = 6;
  float orientation_w = 7;
}

message PoseRequest {
  // Empty
}

message PoseState {
  Pose pose = 1;
}

// Передача OccupancyGrid
message OccupancyGrid {
  uint32 width = 1;
  uint32 height = 2;
  float resolution = 3; // метров на клетку
  bytes data = 4; // данные карты
  Pose origin = 5; // Координата (0,0) карты в мировой системе

  // (Необязательно) frame_id, если хотим понимать в какой системе координат
  // "лежит" карта. Это можно сделать и строкой
  string frame_id = 6;
}

message Point2D {
  double x = 1;
  double y = 2;
}

message ColorRGB {
  uint32 r = 1;
  uint32 g = 2;
  uint32 b = 3;
}

message ZonePassage {
  uint64 to_id = 1;
  repeated Point2D chain_code = 2;
}

message Zone {
  uint64 id = 1;
  uint32 type_id = 2;
  string name = 3;
  string type = 4;
  Point2D centroid = 5;
  ColorRGB color = 6;
  repeated Point2D chain_code = 7;
  repeated ZonePassage passages = 8;
}

message ZoneMap {
  repeated Zone zones = 1;
}

message ZoneRequest {
  // Empty
}

message ZoneState {
  ZoneMap zone_map = 1;
}

// Ответ на запрос карты
message GetMapResponse {
  OccupancyGrid map = 1;
  Pose robotPose = 2;
  ZoneMap zone_map = 3;
  uint64 map_seq = 4;
  uint64 zone_seq = 5;
}

service MapService {
  rpc GetMap(GetMapRequest) returns (GetMapResponse);
}
